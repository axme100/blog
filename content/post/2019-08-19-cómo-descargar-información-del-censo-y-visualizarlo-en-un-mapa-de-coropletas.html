---
title: ¿Cómo descargar información del CENSO y visualizarlo en un mapa de coropletas?
author: Max Carey
date: '2019-08-19'
slug: cómo-descargar-información-del-censo-y-visualizarlo-en-un-mapa-de-coropletas
categories: []
tags: [INEGI, Censo, R, Mapas, Coropletas, mxmaps]
description: ''
topics: []
---



<div id="try-to-get-this-faq-dropdown-to-work" class="section level1">
<h1>Try to get this faq dropdown to work:</h1>
<p><a href="https://codepen.io/Brolik/pen/EgWjzy" class="uri">https://codepen.io/Brolik/pen/EgWjzy</a></p>
<p>Para mi tesis de maestría hice algunos mapas de coropletas que tenían que ver con los chihuahuenses que vivían en la Ciudad de México entre otras cosas. En este post voy a mostrar cómo lo hice, espero poder ayudarle a alguien que quiera hacer algo parecido.</p>
<p>Hay dos tipos de mapas que se hacen: hexbins y coropletas, primero voy a explicar el proceso para crear el mapa hexbin.</p>
</div>
<div id="descargar-los-datos" class="section level1">
<h1>Descargar los datos:</h1>
<p>La INGEGI tiene una <a href="http://www.inegi.org.mx/sistemas/olap/Proyectos/bd/censos/cpv2010/P12Mas.asp?s=est&c=27823&proy=cpv10_p12mas" target=blank>página</a> interactiva (point-and-click) donde uno puede hacer búsquedas personalizadas de los datos obtenidos del Censo de Población y Vivienda 2010. Hasta donde yo sepa, la INEGI no tiene una API para acceder a estos datos, y el interfaz es un poco anticuado, así que se requiere que el usaurio haga varias busquedas para después combinar diferentes datos.</p>
<p>Si quieres leer sobre el proceso de</p>
</div>
<div id="paso-1-cargar-los-paquetes-tidyverse-y-mxmaps" class="section level1">
<h1>Paso 1: Cargar los paquetes <em>tidyverse</em> y <em>mxmaps</em></h1>
<pre class="r"><code>library(tidyverse)
library(&quot;mxmaps&quot;)</code></pre>
</div>
<div id="importar-los-datos" class="section level1">
<h1>Importar los datos</h1>
<pre class="r"><code>datosCDMX &lt;- read.csv(&quot;df.csv&quot;)
datosEDOMEX &lt;- read.csv(&quot;edomex.csv&quot;)</code></pre>
<pre class="r"><code># Set the column names
colnames(datosEDOMEX) &lt;- c(&quot;estado&quot;, &quot;totalEdoMx&quot;, &quot;sinEscoEdoMx&quot;, &quot;eduBasicaEdoMx&quot;, &quot;eduMedSupEdoMx&quot;, &quot;eduSupEdoMx&quot;, &quot;noEspEdoMx&quot;)
colnames(datosCDMX) &lt;- c(&quot;estado&quot;, &quot;totalCdMx&quot;, &quot;sinEscoCdMx&quot;, &quot;eduBasicaCdMx&quot;, &quot;eduMedSupCdMx&quot;, &quot;eduSupCdMx&quot;, &quot;noEspCdMx&quot;)

# Combine the two datasets
datos &lt;- left_join(datosCDMX, datosEDOMEX, by=&quot;estado&quot;)</code></pre>
<pre><code>## Warning: Column `estado` joining factors with different levels, coercing to
## character vector</code></pre>
<pre class="r"><code>remove(datosCDMX, datosEDOMEX)

# Get the different fileds to turn into integers while removing the comas from the dataset
datos &lt;- datos %&gt;%
  mutate(eduBasicaCdMx=as.integer(gsub(&quot;,&quot;, &quot;&quot;, eduBasicaCdMx)),
         eduMedSupCdMx=as.integer(gsub(&quot;,&quot;, &quot;&quot;, eduMedSupCdMx)),
         eduSupCdMx=as.integer(gsub(&quot;,&quot;, &quot;&quot;, eduSupCdMx)),
         # Add the new fields
         totalCdMx=as.integer(gsub(&quot;,&quot;, &quot;&quot;, totalCdMx)),
         sinEscoCdMx=as.integer(gsub(&quot;,&quot;, &quot;&quot;, sinEscoCdMx)),
         noEspCdMx=as.integer(gsub(&quot;,&quot;, &quot;&quot;, noEspCdMx)),
         eduBasicaEdoMx=as.integer(gsub(&quot;,&quot;, &quot;&quot;, eduBasicaEdoMx)),
         eduMedSupEdoMx=as.integer(gsub(&quot;,&quot;, &quot;&quot;, eduMedSupEdoMx)),
         eduSupEdoMx=as.integer(gsub(&quot;,&quot;, &quot;&quot;, eduSupEdoMx)),
         # Add the new fields
         totalEdoMx=as.integer(gsub(&quot;,&quot;, &quot;&quot;, totalEdoMx)),
         sinEscoEdoMx=as.integer(gsub(&quot;,&quot;, &quot;&quot;, sinEscoEdoMx)),
         noEspEdoMx=as.integer(gsub(&quot;,&quot;, &quot;&quot;, noEspEdoMx)))

# Remove the row with MEXICO from the analysis
datos &lt;- datos %&gt;%
  filter(estado!=&quot;México&quot;)


# Get totals for each education level
datos &lt;- datos %&gt;%
  mutate(educacionBasicaTotal = eduBasicaCdMx + eduBasicaEdoMx,
         educacionMediaSuperiorTotal = eduMedSupCdMx + eduMedSupEdoMx,
         educacionSuperiorTotal = eduSupCdMx + eduSupEdoMx)

# Get grand totals
datos &lt;- datos %&gt;%
  mutate(poblacionTotal = totalCdMx + totalEdoMx)

# Get proportion
datos &lt;- datos %&gt;%
  mutate(proporMedSuperior_Superior = round(((educacionMediaSuperiorTotal + educacionSuperiorTotal) / poblacionTotal )*100, digits=2)) %&gt;%
  arrange(desc(proporMedSuperior_Superior))


# Get the data from the mxmap package
df_mxstate &lt;- df_mxstate
# Get offical names and state codes
stateCodes &lt;- df_mxstate %&gt;%
  select(region, state_name_official) %&gt;%
  rename(estado= state_name_official)

# Add the region to the data that I have calculated
datos &lt;- left_join(datos, stateCodes, by=&quot;estado&quot;)

# Create the graph
# The data frame must contain value which in the case,
# I will just set equal to the proportion that I had above
datos$value = datos$proporMedSuperior_Superior

mxhexbin_choropleth(datos, num_colors = 1,
                    title = &quot;&quot;,
                    legend = &quot;%&quot;)</code></pre>
<pre><code>## Warning in self$bind(): The following regions were missing and are being
## set to NA: 09, 15</code></pre>
<p><img src="/post/2019-08-19-c%C3%B3mo-descargar-informaci%C3%B3n-del-censo-y-visualizarlo-en-un-mapa-de-coropletas_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<script>
$('.faq li .question').click(function () {
  $(this).find('.plus-minus-toggle').toggleClass('collapsed');
  $(this).parent().toggleClass('active');
});
</script>
</div>
